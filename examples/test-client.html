<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket Client Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        h1, h2 {
            color: #333;
            margin-top: 0;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .danger {
            background: #dc3545;
        }
        
        .danger:hover {
            background: #c82333;
        }
        
        .messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
        }
        
        .message {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .message.sent {
            background: #e3f2fd;
            border-left: 3px solid #2196f3;
        }
        
        .message.received {
            background: #f3e5f5;
            border-left: 3px solid #9c27b0;
        }
        
        .message.error {
            background: #ffebee;
            border-left: 3px solid #f44336;
        }
        
        .message.system {
            background: #e8f5e8;
            border-left: 3px solid #4caf50;
        }
        
        .timestamp {
            color: #666;
            font-size: 10px;
        }
        
        .channels {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .channel-tag {
            background: #e9ecef;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid #ced4da;
        }
        
        .channel-tag.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <h1>Socket Client Test</h1>
    
    <div class="container">
        <div class="panel">
            <h2>Connection</h2>
            <div class="status" id="status">Disconnected</div>
            
            <div class="form-group">
                <label for="server-url">Server URL:</label>
                <input type="text" id="server-url" value="ws://localhost:8080/ws">
            </div>
            
            <button id="connect-btn" onclick="connect()">Connect</button>
            <button id="disconnect-btn" onclick="disconnect()" disabled>Disconnect</button>
            
            <h3>Authentication</h3>
            <div class="form-group">
                <label for="jwt-token">JWT Token:</label>
                <input type="text" id="jwt-token" placeholder="Optional JWT token">
            </div>
            <button onclick="authenticate()" id="auth-btn" disabled>Authenticate</button>
        </div>
        
        <div class="panel">
            <h2>Channels</h2>
            <div class="channels" id="channels"></div>
            
            <div class="form-group">
                <label for="channel-name">Channel Name:</label>
                <input type="text" id="channel-name" placeholder="Enter channel name">
            </div>
            
            <button onclick="joinChannel()" id="join-btn" disabled>Join Channel</button>
            <button onclick="leaveChannel()" id="leave-btn" disabled>Leave Channel</button>
        </div>
        
        <div class="panel">
            <h2>Send Message</h2>
            
            <div class="form-group">
                <label for="message-channel">Channel:</label>
                <select id="message-channel">
                    <option value="">Select channel</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="message-event">Event:</label>
                <input type="text" id="message-event" value="message" placeholder="Event name">
            </div>
            
            <div class="form-group">
                <label for="message-data">Data (JSON):</label>
                <textarea id="message-data" rows="4" placeholder='{"text": "Hello World"}'></textarea>
            </div>
            
            <button onclick="sendMessage()" id="send-btn" disabled>Send Message</button>
            <button onclick="ping()" id="ping-btn" disabled>Ping</button>
        </div>
        
        <div class="panel">
            <h2>Quick Actions</h2>
            
            <div class="form-group">
                <label>Predefined Messages:</label>
                <button onclick="sendQuickMessage('test', 'hello', {text: 'Hello everyone!'})">Send Hello</button>
                <button onclick="sendQuickMessage('notifications', 'alert', {message: 'Test alert', level: 'info'})">Send Alert</button>
                <button onclick="sendQuickMessage('chat', 'user_joined', {username: 'TestUser'})">User Joined</button>
            </div>
            
            <div class="form-group">
                <label>Test Channels:</label>
                <button onclick="joinTestChannels()">Join Test Channels</button>
                <button onclick="leaveAllChannels()">Leave All</button>
            </div>
            
            <div class="form-group">
                <label>Stress Test:</label>
                <button onclick="startStressTest()">Start Stress Test</button>
                <button onclick="stopStressTest()" class="danger">Stop Test</button>
            </div>
        </div>
        
        <div class="panel full-width">
            <h2>Messages</h2>
            <div class="messages" id="messages"></div>
            <button onclick="clearMessages()">Clear Messages</button>
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;
        let joinedChannels = new Set();
        let stressTestInterval = null;
        
        function updateStatus(message, connected) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + (connected ? 'connected' : 'disconnected');
            isConnected = connected;
            
            // Enable/disable buttons
            document.getElementById('connect-btn').disabled = connected;
            document.getElementById('disconnect-btn').disabled = !connected;
            document.getElementById('auth-btn').disabled = !connected;
            document.getElementById('join-btn').disabled = !connected;
            document.getElementById('leave-btn').disabled = !connected;
            document.getElementById('send-btn').disabled = !connected;
            document.getElementById('ping-btn').disabled = !connected;
        }
        
        function addMessage(message, type = 'received') {
            const messagesEl = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message ' + type;
            
            const timestamp = new Date().toLocaleTimeString();
            messageEl.innerHTML = `
                <div class="timestamp">[${timestamp}] ${type.toUpperCase()}</div>
                <div>${typeof message === 'object' ? JSON.stringify(message, null, 2) : message}</div>
            `;
            
            messagesEl.appendChild(messageEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }
        
        function updateChannels() {
            const channelsEl = document.getElementById('channels');
            const selectEl = document.getElementById('message-channel');
            
            // Update visual channel list
            channelsEl.innerHTML = '';
            selectEl.innerHTML = '<option value="">Select channel</option>';
            
            joinedChannels.forEach(channel => {
                // Visual tag
                const tag = document.createElement('div');
                tag.className = 'channel-tag active';
                tag.textContent = channel;
                channelsEl.appendChild(tag);
                
                // Select option
                const option = document.createElement('option');
                option.value = channel;
                option.textContent = channel;
                selectEl.appendChild(option);
            });
        }
        
        function connect() {
            const url = document.getElementById('server-url').value;
            
            try {
                ws = new WebSocket(url);
                
                ws.onopen = function() {
                    updateStatus('Connected', true);
                    addMessage('Connected to server', 'system');
                };
                
                ws.onmessage = function(event) {
                    const message = JSON.parse(event.data);
                    addMessage(message, 'received');
                    
                    // Handle specific events
                    if (message.event === 'joined_channel') {
                        joinedChannels.add(message.data.channel);
                        updateChannels();
                    } else if (message.event === 'left_channel') {
                        joinedChannels.delete(message.data.channel);
                        updateChannels();
                    } else if (message.event === 'pong') {
                        addMessage('Pong received', 'system');
                    }
                };
                
                ws.onclose = function() {
                    updateStatus('Disconnected', false);
                    addMessage('Disconnected from server', 'system');
                    joinedChannels.clear();
                    updateChannels();
                };
                
                ws.onerror = function(error) {
                    addMessage('WebSocket error: ' + error, 'error');
                };
                
            } catch (error) {
                addMessage('Connection error: ' + error, 'error');
            }
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
            }
        }
        
        function authenticate() {
            const token = document.getElementById('jwt-token').value;
            if (!token) {
                addMessage('No JWT token provided', 'error');
                return;
            }
            
            sendMessage({
                action: 'authenticate',
                token: token
            });
        }
        
        function joinChannel() {
            const channelName = document.getElementById('channel-name').value;
            if (!channelName) {
                addMessage('No channel name provided', 'error');
                return;
            }
            
            sendMessage({
                action: 'join_channel',
                channel: channelName
            });
        }
        
        function leaveChannel() {
            const channelName = document.getElementById('channel-name').value;
            if (!channelName) {
                addMessage('No channel name provided', 'error');
                return;
            }
            
            sendMessage({
                action: 'leave_channel',
                channel: channelName
            });
        }
        
        function sendMessage(messageObj = null) {
            if (!ws || !isConnected) {
                addMessage('Not connected to server', 'error');
                return;
            }
            
            let message;
            
            if (messageObj) {
                message = messageObj;
            } else {
                const channel = document.getElementById('message-channel').value;
                const event = document.getElementById('message-event').value;
                const dataText = document.getElementById('message-data').value;
                
                if (!channel) {
                    addMessage('No channel selected', 'error');
                    return;
                }
                
                let data;
                try {
                    data = dataText ? JSON.parse(dataText) : {};
                } catch (error) {
                    addMessage('Invalid JSON data: ' + error.message, 'error');
                    return;
                }
                
                message = {
                    action: 'send_message',
                    channel: channel,
                    event: event,
                    data: data
                };
            }
            
            ws.send(JSON.stringify(message));
            addMessage(message, 'sent');
        }
        
        function ping() {
            sendMessage({
                action: 'ping'
            });
        }
        
        function sendQuickMessage(channel, event, data) {
            // Join channel if not already joined
            if (!joinedChannels.has(channel)) {
                sendMessage({
                    action: 'join_channel',
                    channel: channel
                });
                // Wait a bit for join to complete
                setTimeout(() => {
                    sendMessage({
                        action: 'send_message',
                        channel: channel,
                        event: event,
                        data: data
                    });
                }, 100);
            } else {
                sendMessage({
                    action: 'send_message',
                    channel: channel,
                    event: event,
                    data: data
                });
            }
        }
        
        function joinTestChannels() {
            const testChannels = ['test', 'chat', 'notifications', 'events'];
            testChannels.forEach(channel => {
                sendMessage({
                    action: 'join_channel',
                    channel: channel
                });
            });
        }
        
        function leaveAllChannels() {
            joinedChannels.forEach(channel => {
                sendMessage({
                    action: 'leave_channel',
                    channel: channel
                });
            });
        }
        
        function startStressTest() {
            if (stressTestInterval) {
                return;
            }
            
            let counter = 0;
            stressTestInterval = setInterval(() => {
                sendQuickMessage('stress-test', 'message', {
                    counter: counter++,
                    timestamp: Date.now(),
                    text: 'Stress test message #' + counter
                });
            }, 100); // Send message every 100ms
            
            addMessage('Stress test started', 'system');
        }
        
        function stopStressTest() {
            if (stressTestInterval) {
                clearInterval(stressTestInterval);
                stressTestInterval = null;
                addMessage('Stress test stopped', 'system');
            }
        }
        
        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }
        
        // Initialize
        updateStatus('Disconnected', false);
        updateChannels();
    </script>
</body>
</html>
